# äº‘èš-CRMï¼šå¤šæ™ºèƒ½ä½“å®¢æˆ·æœåŠ¡å¹³å°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä½¿ç”¨ Next.js, Genkit, å’Œ TypeScript æ„å»ºçš„ç°ä»£åŒ–ã€åŠŸèƒ½ä¸°å¯Œçš„å¤šæ™ºèƒ½ä½“å®¢æˆ·æœåŠ¡ï¼ˆCRMï¼‰å¹³å°ã€‚å®ƒæä¾›äº†ä¸€æ•´å¥—ä»ç®¡ç†å‘˜ã€åå¸­åˆ°è®¿å®¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œå¹¶é›†æˆäº†å…ˆè¿›çš„AIèƒ½åŠ›ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

- å®‰è£…ä¾èµ–å¹¶ä¸€é”®å¯åŠ¨ï¼ˆNext.js å‰ç«¯ + æœ¬åœ° WebSocket æœåŠ¡ï¼‰
  - npm install
  - npm run dev:full
  - å‰ç«¯ï¼šhttp://localhost:3001
- ç®¡ç†å‘˜ç™»å½•
  - åœ¨ç™»å½•é¡µç›´æ¥è¾“å…¥ .env ä¸­çš„ ADMIN_KEYï¼ˆé»˜è®¤ admin8888ï¼‰
- ç”Ÿæˆåå¸­å¯†é’¥
  - è¿›å…¥â€œå¯†é’¥ç®¡ç†â€ï¼Œé€‰æ‹©ç±»å‹ä¸º agentï¼Œåˆ›å»ºå¯†é’¥å¹¶å¤åˆ¶
- åå¸­ç™»å½•ï¼ˆå·²æ”¯æŒé¦–æ¬¡ç™»å½•è‡ªåŠ¨åˆ›å»ºå¹¶ç»‘å®šåå¸­ï¼‰
  - é€€å‡ºç™»å½•ï¼Œç”¨åˆšæ‰å¤åˆ¶çš„ agent å¯†é’¥ç›´æ¥ç™»å½•ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¹¶ç»‘å®šä¸€ä¸ªæ–°åå¸­ï¼Œè¿›å…¥ /agent å·¥ä½œå°
- ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆå¯¹å¤– 1 å¯¹å¤šï¼‰
  - åå¸­å·¦ä¸‹è§’å¤´åƒ â†’ åˆ†äº«èŠå¤©é“¾æ¥ â†’ å¤åˆ¶ /naoiod/{token} é“¾æ¥æˆ–ä¸‹è½½äºŒç»´ç 
  - æŠŠé“¾æ¥å‘ç»™ç”¨æˆ·å³å¯ï¼Œä¸€ä¸ªåå¸­å¯ä»¥åŒæ—¶æ¥å¾…å¤šä¸ªè®¿å®¢

## âœ… æœ€å°æµç¨‹è¯´æ˜

1) ç®¡ç†å‘˜ç”¨ ADMIN_KEY ç™»å½• â†’ 2) ç®¡ç†é¢æ¿åˆ›å»º agent å¯†é’¥ â†’ 3) åå¸­ç”¨è¯¥å¯†é’¥ç›´æ¥ç™»å½•ï¼ˆé¦–ç™»è‡ªåŠ¨å»ºæ¡£å¹¶ç»‘å®šï¼‰ â†’ 4) ç”Ÿæˆåˆ†äº«é“¾æ¥ â†’ 5) è®¿å®¢æ‰“å¼€é“¾æ¥å¼€å§‹èŠå¤©ï¼ˆåå¸­ç«¯å·¦ä¾§å¯çœ‹åˆ°å¤šä¸ªä¼šè¯å¹¶åˆ‡æ¢ï¼‰

æ³¨ï¼šWebSocket æœåŠ¡ç”¨äºæ›´å¥½çš„å®æ—¶ä½“éªŒï¼›å¦‚æœæœªå¯åŠ¨ï¼Œç³»ç»Ÿä»å¯é€šè¿‡è½®è¯¢æ­£å¸¸å·¥ä½œã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **ç®¡ç†å‘˜ä»ªè¡¨ç›˜**:
  - **å¯†é’¥ç®¡ç†**: åˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘å’Œç®¡ç†ç”¨äºç™»å½•ç³»ç»Ÿçš„è®¿é—®å¯†é’¥ï¼ˆåå¸­æˆ–ç®¡ç†å‘˜ç±»å‹ï¼‰ã€‚
  - **åå¸­ç®¡ç†**: ç»Ÿä¸€æŸ¥çœ‹ç³»ç»Ÿå†…æ‰€æœ‰åå¸­çš„çŠ¶æ€ã€æ´»åŠ¨å’Œç»‘å®šçš„å¯†é’¥ã€‚
  - **æ•°æ®ç»Ÿè®¡**: æ¦‚è§ˆå¹³å°æ ¸å¿ƒæŒ‡æ ‡ï¼Œå¦‚åå¸­æ€»æ•°ã€åœ¨çº¿äººæ•°ã€å¯†é’¥çŠ¶æ€ç­‰ã€‚

- **åå¸­å·¥ä½œå°**:
  - **å®æ—¶èŠå¤©**: ä¸æ¥è‡ªä¸åŒæ¸ é“çš„è®¿å®¢è¿›è¡Œå®æ—¶ã€ä¸€å¯¹ä¸€çš„æ²Ÿé€šã€‚
  - **ä¼šè¯ç®¡ç†**: æ¸…æ™°çš„ä¼šè¯åˆ—è¡¨ï¼Œå¯ä»¥åˆ‡æ¢ã€å½’æ¡£å’Œæ¢å¤èŠå¤©ã€‚
  - **å®¢æˆ·ä¿¡æ¯é¢æ¿**: åœ¨èŠå¤©æ—¶å¯ä»¥éšæ—¶æŸ¥çœ‹è®¿å®¢çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚IPã€åœ°ç†ä½ç½®ã€è®¾å¤‡ç­‰ï¼‰ã€‚
  - **å¿«æ·å›å¤**: è®¾ç½®å¹¶ä½¿ç”¨å¸¸ç”¨è¯­ï¼Œä¸€é”®å‘é€ï¼Œæå‡å“åº”æ•ˆç‡ã€‚
  - **æ™ºèƒ½è¾…åŠ©**: å†…ç½®åŸºäº Genkit çš„ PIIï¼ˆä¸ªäººèº«ä»½ä¿¡æ¯ï¼‰ä¸€é”®è„±æ•åŠŸèƒ½ï¼Œç¡®ä¿å¯¹è¯å®‰å…¨ã€‚

- **è®¿å®¢èŠå¤©ç•Œé¢**:
  - é€šè¿‡å”¯ä¸€çš„åˆ†äº«é“¾æ¥æˆ–äºŒç»´ç ï¼Œè®¿å®¢å¯ä»¥è½»æ¾åœ°ä¸æŒ‡å®šåå¸­å»ºç«‹èŠå¤©ä¼šè¯ã€‚

- **åŠ¨æ€å¯†é’¥ä¸åˆ†äº«é“¾æ¥ç³»ç»Ÿ**:
  - **å›ºå®šåˆ°æœŸç‚¹**: å¯†é’¥å…·æœ‰å›ºå®šçš„æ¯æ—¥åˆ°æœŸæ—¶é—´ç‚¹ï¼ˆä¾‹å¦‚ 12:00 æˆ– 00:00ï¼‰ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚
  - **æ›¿æ¢å¼ç»‘å®š**: åå¸­é€šè¿‡ç»‘å®šä¸€ä¸ªæœ‰æ•ˆçš„ã€æœªä½¿ç”¨çš„å¯†é’¥æ¥è·å–æˆ–å»¶é•¿è®¿é—®æƒé™ï¼Œæ—§å¯†é’¥ç«‹å³å¤±æ•ˆã€‚
  - **åŒæ­¥å¤±æ•ˆçš„åˆ†äº«é“¾æ¥**: åå¸­å¯ä»¥ç”Ÿæˆä¸å½“å‰å¯†é’¥æœ‰æ•ˆæœŸåŒæ­¥çš„åˆ†äº«é“¾æ¥å’ŒäºŒç»´ç ã€‚å½“åå¸­æ›´æ¢å¯†é’¥åï¼Œæ—§çš„åˆ†äº«é“¾æ¥å°†è‡ªåŠ¨ä½œåºŸï¼Œéœ€è¦é‡æ–°ç”Ÿæˆã€‚

- **æµç¨‹æ€»ç»“**
- ç®¡ç†å‘˜è·å–å¯†é’¥ â†’ createKey()
- å®¢æœç™»å½•å¯†é’¥ç»‘å®š â†’ bindKeyToUser   (userId, key)
- ç”ŸæˆçŸ­é“¾/QRç åˆ†äº« â†’ generateShortLink(shareId, key)
- è®¿é—®çŸ­é“¾ â†’ resolveShortLink(token) æ ¡éªŒæ˜¯å¦è¿‡æœŸ
- å¯†é’¥ç»­æœŸ/å»¶ç»­ â†’ renewKeyForUser(userId)ï¼Œæ—§å¯†é’¥å¤±æ•ˆï¼Œæ–°å¯†é’¥ç»‘å®šï¼ŒçŸ­é“¾é‡æ–°ç”Ÿæˆ
- å®šæ—¶æ¸…ç† â†’ å†…å­˜è‡ªåŠ¨åˆ é™¤è¿‡æœŸå¯†é’¥å’ŒçŸ­é“¾

- **å¯†é’¥ä¸çŸ­é“¾ç®¡ç†æµç¨‹å›¾æ–‡å­—ç‰ˆç¤ºæ„**

- [ç®¡ç†å‘˜ç”Ÿæˆå¯†é’¥] 
        â”‚ createKey()
        â–¼
- [å¯†é’¥å†…å­˜æ± å­˜å‚¨] â”€â”€â–º expireAtè®¡ç®— (æŒ‰0ç‚¹/12ç‚¹å¯¹é½)
        â”‚
        â–¼
- [å®¢æœç»‘å®šå¯†é’¥ç™»å½•] 
        â”‚ bindKeyToUser(userId, key)
        â”‚  â””â”€> æ ¡éªŒæ˜¯å¦è¿‡æœŸ
        â–¼
- [å¯†é’¥ç»‘å®šæˆåŠŸ] â”€â”€â–º å¯ä½¿ç”¨ç”ŸæˆçŸ­é“¾
        â”‚
        â–¼
- [ç”ŸæˆçŸ­é“¾/QRç ] 
        â”‚ generateShortLink(shareId, key)
        â”‚  â””â”€> çŸ­é“¾ expireAt = å¯†é’¥ expireAt
        â–¼
- [ç”¨æˆ·æ‰«ç /è®¿é—®çŸ­é“¾] 
        â”‚ resolveShortLink(token)
        â”‚  â””â”€> æ ¡éªŒæ˜¯å¦è¿‡æœŸ
        â–¼
- [è®¿é—® naoiod/{token} é¡µé¢]
        â”‚
        â–¼
- [å¯†é’¥è¿‡æœŸ] 
        â”‚  â””â”€> å®šæ—¶æ¸…ç† / ç«‹å³è§£ç»‘
        â–¼
- [å¯ç»­æœŸ/å»¶ç»­å¯†é’¥]
        â”‚ renewKeyForUser(userId)
        â”‚  â””â”€> æ–°å¯†é’¥ç»‘å®šï¼Œæ—§å¯†é’¥å¤±æ•ˆï¼ŒçŸ­é“¾é‡æ–°ç”Ÿæˆ
        â–¼
- [æ–°çš„æœ‰æ•ˆå¯†é’¥ & çŸ­é“¾ç»§ç»­ä½¿ç”¨]

## ğŸ› ï¸ æ ¸å¿ƒè®¾è®¡è¦ç‚¹

- **å¯†é’¥åˆ°æœŸæ—¶é—´å¯¹é½**

- **0ç‚¹åé¢†å– â†’ åˆ°å½“å¤©12ç‚¹è¿‡æœŸ**

- **12ç‚¹åé¢†å– â†’ æ¬¡æ—¥0ç‚¹è¿‡æœŸ**

- **å¯†é’¥ç»­æœŸ/å»¶ç»­**

- **å¯ä»¥ç”Ÿæˆæ–°å¯†é’¥ç»‘å®šåˆ°åŒä¸€å®¢æœ**

- **æ—§å¯†é’¥ç«‹å³å¤±æ•ˆ**

- **çŸ­é“¾å¯é‡æ–°ç»‘å®šæ–°å¯†é’¥å»¶é•¿æœ‰æ•ˆæœŸ**

- **çŸ­é“¾ä¸å¯†é’¥å…³è”**

- **çŸ­é“¾æœ‰æ•ˆæœŸ = ç»‘å®šå¯†é’¥çš„ expireAt**

- **æ ¡éªŒçŸ­é“¾æ—¶è‡ªåŠ¨æ£€æµ‹å¯†é’¥æ˜¯å¦æœ‰æ•ˆ**

- **å†…å­˜ç®¡ç†**

- **æ¯åˆ†é’Ÿå®šæ—¶æ¸…ç†è¿‡æœŸå¯†é’¥å’ŒçŸ­é“¾**

- **ä¿è¯å†…å­˜ä¸ä¼šæ— é™ç´¯ç§¯**

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: [Next.js](https://nextjs.org/) (ä½¿ç”¨ App Router)
- **ç¼–ç¨‹è¯­è¨€**: [TypeScript](https://www.typescriptlang.org/)
- **UI ç»„ä»¶åº“**: [ShadCN/UI](https://ui.shadcn.com/)
- **æ ·å¼æ–¹æ¡ˆ**: [Tailwind CSS](https://tailwindcss.com/)
- **AI é›†æˆ**: [Genkit (by Firebase)](https://firebase.google.com/docs/genkit)
- **çŠ¶æ€ç®¡ç†**: [Zustand](https://github.com/pmndrs/zustand)
- **å›¾æ ‡åº“**: [Lucide React](https://lucide.dev/)
- **æ—¥æœŸå¤„ç†**: [date-fns](https://date-fns.org/)
